# æ¨¡å—éªŒè¯æ¡†æ¶ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æ¨¡å—éªŒè¯æ¡†æ¶æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„Pythonæµ‹è¯•å¹³å°ï¼Œæ”¯æŒå¤šç§I2Cé€‚é…å™¨å’Œæ¨¡ç»„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚æ¡†æ¶é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°çš„é€‚é…å™¨ã€æ¨¡ç»„å’Œæµ‹è¯•ä»»åŠ¡ã€‚

## æ–°å¢åŠŸèƒ½ (v1.0.0)

### ğŸ†• INA219æ¨¡ç»„æ”¯æŒ
- æ–°å¢å•é€šé“ç”µæµ/ç”µå‹/åŠŸç‡ç›‘æµ‹èŠ¯ç‰‡æ”¯æŒ
- è‡ªåŠ¨æ ¡å‡†åŠŸèƒ½ï¼Œæ”¯æŒå¯é…ç½®çš„åˆ†æµç”µé˜»å€¼
- æ”¯æŒ16Vå’Œ32Væ€»çº¿ç”µå‹èŒƒå›´

### ğŸš€ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
- å®Œæ•´çš„å‘½ä»¤è¡Œå‚æ•°æ”¯æŒï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–æµ‹è¯•
- æ”¯æŒæ‰€æœ‰æµ‹è¯•åœºæ™¯çš„å‚æ•°åŒ–è¿è¡Œ
- ä¿æŒä¸äº¤äº’å¼æ¨¡å¼çš„å®Œå…¨å…¼å®¹

### ğŸ”§ æ”¹è¿›çš„èµ„æºç®¡ç†
- å¼ºåŒ–çš„èµ„æºæ¸…ç†æœºåˆ¶
- é˜²æ­¢I2Cè®¾å¤‡å†²çªå’Œèµ„æºæ³„æ¼
- æ”¯æŒå¼‚å¸¸æƒ…å†µä¸‹çš„å®‰å…¨é€€å‡º

## å¿«é€Ÿå¼€å§‹

### 1. äº¤äº’å¼æ¨¡å¼ (æ¨èæ–°æ‰‹)

```bash
cd d:\dev\EE_PROJECTs\Module_Validation
python main.py
```

æŒ‰ç…§èœå•æç¤ºé€‰æ‹©é€‚é…å™¨ã€æ¨¡ç»„å’Œæµ‹è¯•ä»»åŠ¡ã€‚

### 2. å‘½ä»¤è¡Œæ¨¡å¼ (æ¨èè‡ªåŠ¨åŒ–)

```bash
# åŸºæœ¬ç”µæµé‡‡æ ·æµ‹è¯•
python main.py --adapter ch341 --module ina3221 --task current_sampling --duration 5 --interval 100

# è¿ç»­é‡‡æ ·æµ‹è¯•
python main.py --adapter ch341 --module ina3221 --task continuous_sampling --interval 200

# æŸ¥çœ‹æ”¯æŒçš„ç»„ä»¶
python main.py --list-adapters
python main.py --list-modules
python main.py --list-tasks
```

### 3. ç¤ºä¾‹ï¼šCH341 + INA3221ç”µæµé‡‡æ ·

#### äº¤äº’å¼æ–¹å¼ï¼š
1. è¿è¡Œ `python main.py`
2. é€‰æ‹© "1. é€‰æ‹©I2Cé€‚é…å™¨"
3. é€‰æ‹© "1. CH341 USB-I2C Adapter"
4. è¾“å…¥è®¾å¤‡ç´¢å¼•ï¼ˆé»˜è®¤0ï¼‰
5. é€‰æ‹© "2. é€‰æ‹©æµ‹è¯•æ¨¡ç»„" 
6. é€‰æ‹© "1. INA3221 Triple Current Monitor"
7. è¾“å…¥è®¾å¤‡åœ°å€ï¼ˆé»˜è®¤0x40ï¼‰
8. é€‰æ‹© "3. æ‰§è¡Œæµ‹è¯•ä»»åŠ¡"
9. é€‰æ‹©æµ‹è¯•ä»»åŠ¡å¹¶é…ç½®å‚æ•°

#### å‘½ä»¤è¡Œæ–¹å¼ï¼š
```bash
python main.py --adapter ch341 --module ina3221 --task current_sampling --duration 5 --interval 100 --channels 1 2 3
```

## å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

### åŸºæœ¬å‚æ•°
- `--adapter, -a`: I2Cé€‚é…å™¨ç±»å‹ (ch341, cp2112)
- `--device-index, -d`: é€‚é…å™¨è®¾å¤‡ç´¢å¼• (é»˜è®¤: 0)
- `--module, -m`: æµ‹è¯•æ¨¡ç»„ç±»å‹ (ina3221, ina219)
- `--module-addr, -addr`: æ¨¡ç»„I2Cåœ°å€ (é»˜è®¤: 0x40)
- `--task, -t`: æµ‹è¯•ä»»åŠ¡ç±»å‹ (current_sampling, continuous_sampling)

### ä»»åŠ¡å‚æ•°
- `--duration`: é‡‡æ ·æŒç»­æ—¶é—´(ç§’) - ä»…ç”¨äºcurrent_sampling (é»˜è®¤: 1.0)
- `--interval`: é‡‡æ ·é—´éš”(æ¯«ç§’) (é»˜è®¤: 100.0)
- `--channels`: é‡‡æ ·é€šé“åˆ—è¡¨ (ä¾‹å¦‚: --channels 1 2 3)
- `--no-display`: ç¦ç”¨å®æ—¶æ•°æ®æ˜¾ç¤º
- `--log-level`: æ—¥å¿—çº§åˆ« (DEBUG, INFO, WARNING, ERROR)

### ä¿¡æ¯æŸ¥è¯¢
- `--help`: æ˜¾ç¤ºå®Œæ•´å¸®åŠ©ä¿¡æ¯
- `--list-adapters`: åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„I2Cé€‚é…å™¨
- `--list-modules`: åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„æ¨¡ç»„
- `--list-tasks`: åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„æµ‹è¯•ä»»åŠ¡

## æ¡†æ¶ç‰¹æ€§

### æ”¯æŒçš„é€‚é…å™¨

| é€‚é…å™¨ | çŠ¶æ€ | æè¿° |
|--------|------|------|
| **CH341** | âœ… å®Œæ•´æ”¯æŒ | WCH CH341èŠ¯ç‰‡USBè½¬I2Cé€‚é…å™¨ |
| **CP2112** | âœ… å®Œæ•´æ”¯æŒ | Silicon Labs CP2112èŠ¯ç‰‡USBè½¬I2C/SMBusé€‚é…å™¨ |

### æ”¯æŒçš„æ¨¡ç»„

| æ¨¡ç»„ | é€šé“æ•° | åŠŸèƒ½ | çŠ¶æ€ |
|------|--------|------|------|
| **INA3221** | 3 | ç”µæµ/ç”µå‹/åŠŸç‡ç›‘æµ‹ | âœ… å®Œæ•´æ”¯æŒ |
| **INA219** | 1 | ç”µæµ/ç”µå‹/åŠŸç‡ç›‘æµ‹ | ğŸ†• æ–°å¢æ”¯æŒ |

### æ”¯æŒçš„ä»»åŠ¡

| ä»»åŠ¡ | æè¿° | å‚æ•° |
|------|------|------|
| **ç”µæµé‡‡æ ·ä»»åŠ¡** | é«˜ç²¾åº¦å®šæ—¶ç”µæµé‡‡æ · | æŒç»­æ—¶é—´ã€é—´éš”ã€é€šé“ |
| **è¿ç»­é‡‡æ ·ä»»åŠ¡** | ç”¨æˆ·å¯æ§çš„è¿ç»­é‡‡æ · | é—´éš”ã€é€šé“ã€æ˜¾ç¤ºé€‰é¡¹ |

## ä½¿ç”¨ç¤ºä¾‹

### ç”µæµé‡‡æ ·æµ‹è¯•
```bash
# åŸºæœ¬æµ‹è¯• - INA3221å…¨é€šé“5ç§’é‡‡æ ·
python main.py --adapter ch341 --module ina3221 --task current_sampling --duration 5 --interval 100

# å•é€šé“æµ‹è¯• - INA219é«˜ç²¾åº¦é‡‡æ ·
python main.py --adapter cp2112 --module ina219 --task current_sampling --duration 10 --interval 50 --channels 1

# å¤šé€šé“æµ‹è¯• - æŒ‡å®šé€šé“é‡‡æ ·
python main.py --adapter ch341 --module ina3221 --task current_sampling --duration 5 --channels 1 2 3
```

### è¿ç»­é‡‡æ ·æµ‹è¯•
```bash
# å®æ—¶æ˜¾ç¤ºé‡‡æ ·æ•°æ® (æŒ‰qåœæ­¢)
python main.py --adapter ch341 --module ina3221 --task continuous_sampling --interval 200

# é™é»˜æ¨¡å¼é‡‡æ ·
python main.py --adapter cp2112 --module ina219 --task continuous_sampling --interval 500 --no-display

# é«˜é¢‘é‡‡æ ·
python main.py --adapter ch341 --module ina3221 --task continuous_sampling --interval 50 --channels 1
```

### æŒ‡å®šè®¾å¤‡å‚æ•°
```bash
# ä½¿ç”¨ç¬¬äºŒä¸ªè®¾å¤‡å’Œéæ ‡å‡†åœ°å€
python main.py --adapter ch341 --device-index 1 --module ina219 --module-addr 0x41 --task current_sampling --duration 3

# åå…­è¿›åˆ¶åœ°å€æ ¼å¼
python main.py --adapter ch341 --module ina219 --module-addr 0x45 --task current_sampling --duration 2
```

### è°ƒè¯•å’Œå¼€å‘
```bash
# è°ƒè¯•æ¨¡å¼ - æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
python main.py --log-level DEBUG --adapter ch341 --module ina3221 --task current_sampling --duration 1

# æ‰«æI2Cæ€»çº¿
python main.py  # è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œé€‰æ‹© "5. æ‰«æI2Cæ€»çº¿"
```

## ç›®å½•ç»“æ„

```
Module_Validation/
â”œâ”€â”€ main.py                          # ä¸»å…¥å£ç¨‹åº (æ”¯æŒå‘½ä»¤è¡Œå‚æ•°)
â”œâ”€â”€ framework/                       # æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ interfaces.py                # æŠ½è±¡æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ adapters/                    # é€‚é…å™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ ch341_adapter.py         # CH341é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ cp2112_adapter.py        # CP2112é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ __init__.py              # é€‚é…å™¨æ³¨å†Œ
â”‚   â”œâ”€â”€ modules/                     # æ¨¡ç»„å®ç°
â”‚   â”‚   â”œâ”€â”€ ina3221_module.py        # INA3221ä¸‰é€šé“æ¨¡ç»„
â”‚   â”‚   â”œâ”€â”€ ina219_module.py         # ğŸ†• INA219å•é€šé“æ¨¡ç»„
â”‚   â”‚   â””â”€â”€ __init__.py              # æ¨¡ç»„æ³¨å†Œ
â”‚   â””â”€â”€ tasks/                       # ä»»åŠ¡å®ç°
â”‚       â”œâ”€â”€ current_sampling.py     # ç”µæµé‡‡æ ·ä»»åŠ¡
â”‚       â”œâ”€â”€ continuous_sampling.py  # è¿ç»­é‡‡æ ·ä»»åŠ¡
â”‚       â””â”€â”€ __init__.py              # ä»»åŠ¡æ³¨å†Œ
â”œâ”€â”€ test/                            # ğŸ†• æµ‹è¯•è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ test_cli_args.py             # å‘½ä»¤è¡Œå‚æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ test_resource_cleanup.py     # èµ„æºæ¸…ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test_default_interval.py     # é»˜è®¤é—´éš”æµ‹è¯•
â”‚   â”œâ”€â”€ examples.py                  # ä½¿ç”¨ç¤ºä¾‹å’Œæ•…éšœæ’é™¤
â”‚   â””â”€â”€ test.py                      # æ¡†æ¶ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ quick_test.py                    # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â””â”€â”€ device/                          # è®¾å¤‡é©±åŠ¨å’Œæ–‡æ¡£
    â”œâ”€â”€ ch341/                       # CH341ç›¸å…³æ–‡ä»¶
    â””â”€â”€ cp2112/                      # CP2112ç›¸å…³æ–‡ä»¶
```

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„é€‚é…å™¨

1. åœ¨ `framework/adapters/` ä¸‹åˆ›å»ºæ–°çš„é€‚é…å™¨æ–‡ä»¶
2. ç»§æ‰¿ `AdapterInterface` å¹¶å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
3. åœ¨ `framework/adapters/__init__.py` ä¸­æ³¨å†Œæ–°é€‚é…å™¨

### æ·»åŠ æ–°çš„æ¨¡ç»„

1. åœ¨ `framework/modules/` ä¸‹åˆ›å»ºæ–°çš„æ¨¡ç»„æ–‡ä»¶  
2. ç»§æ‰¿ `ModuleInterface` å¹¶å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
3. åœ¨ `framework/modules/__init__.py` ä¸­æ³¨å†Œæ–°æ¨¡ç»„

### æ·»åŠ æ–°çš„ä»»åŠ¡

1. åœ¨ `framework/tasks/` ä¸‹åˆ›å»ºæ–°çš„ä»»åŠ¡æ–‡ä»¶
2. ç»§æ‰¿ `TaskInterface` å¹¶å®ç° `execute` æ–¹æ³•
3. åœ¨ `framework/tasks/__init__.py` ä¸­æ³¨å†Œæ–°ä»»åŠ¡

## æµ‹è¯•å’ŒéªŒè¯

### ç»„ä»¶æµ‹è¯•

```bash
python quick_test.py                # éªŒè¯ç»„ä»¶æ³¨å†Œ
python test/test.py                 # å®Œæ•´ç»„ä»¶æµ‹è¯•
python test/test_cli_args.py        # å‘½ä»¤è¡Œå‚æ•°æµ‹è¯•
python test/test_resource_cleanup.py # èµ„æºæ¸…ç†æµ‹è¯•
python test/examples.py             # æŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹
```

### ç¡¬ä»¶è¦æ±‚

- CH341T/CH341A USBå¼€å‘æ¿ æˆ– CP2112å¼€å‘æ¿
- INA3221ä¸‰é€šé“ç”µæµç›‘æµ‹æ¨¡ç»„ æˆ– INA219å•é€šé“æ¨¡ç»„
- USBè¿æ¥çº¿
- I2Cè¿æ¥çº¿ï¼ˆæœé‚¦çº¿ï¼‰

### è½¯ä»¶è¦æ±‚

- Windows 10/11
- Python 3.6+
- å¯¹åº”çš„USBé©±åŠ¨ç¨‹åº (CH341é©±åŠ¨ æˆ– CP2112é©±åŠ¨)

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é€‚é…å™¨åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥I2Cé€‚é…å™¨æ˜¯å¦æ­£ç¡®è¿æ¥åˆ°è®¡ç®—æœº
   - ç¡®è®¤è®¾å¤‡é©±åŠ¨ç¨‹åºå·²æ­£ç¡®å®‰è£…
   - å°è¯•ä¸åŒçš„è®¾å¤‡ç´¢å¼• (--device-index 0, 1, 2...)
   - æŸ¥çœ‹è®¾å¤‡ç®¡ç†å™¨ä¸­æ˜¯å¦æœ‰ç›¸å…³è®¾å¤‡

2. **è®¾å¤‡æ‰“å¼€å¤±è´¥**
   - ç¡®è®¤è®¾å¤‡æœªè¢«å…¶ä»–ç¨‹åºå ç”¨
   - æ£€æŸ¥USBè¿æ¥æ˜¯å¦ç¨³å®š
   - å°è¯•é‡æ–°æ’æ‹”è®¾å¤‡
   - è¿è¡Œ `python main.py --list-adapters` ç¡®è®¤é€‚é…å™¨ç±»å‹

3. **æ¨¡ç»„åˆå§‹åŒ–å¤±è´¥**
   - æ£€æŸ¥I2Cè¿æ¥çº¿è·¯æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æ¨¡ç»„çš„I2Cåœ°å€è®¾ç½®
   - ä½¿ç”¨ I2C æ‰«æåŠŸèƒ½æŸ¥æ‰¾è®¾å¤‡åœ°å€
   - æ£€æŸ¥ä¾›ç”µæ˜¯å¦æ­£å¸¸

4. **é‡‡æ ·æ•°æ®å¼‚å¸¸**
   - æ£€æŸ¥åˆ†æµç”µé˜»å€¼æ˜¯å¦é…ç½®æ­£ç¡®
   - ç¡®è®¤è¢«æµ‹ç”µè·¯è¿æ¥æ­£ç¡®
   - è°ƒæ•´é‡‡æ ·é—´éš”ï¼Œé¿å…è¿‡äºé¢‘ç¹
   - æ£€æŸ¥æ¨¡ç»„çš„é‡ç¨‹è®¾ç½®

### è°ƒè¯•å»ºè®®

```bash
# ä½¿ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
python main.py --log-level DEBUG --adapter ch341 --module ina3221 --task current_sampling --duration 1

# æ‰«æI2Cæ€»çº¿æŸ¥æ‰¾è®¾å¤‡
python main.py  # è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œé€‰æ‹© "5. æ‰«æI2Cæ€»çº¿"

# æµ‹è¯•åŸºæœ¬åŠŸèƒ½
python quick_test.py

# æ£€æŸ¥èµ„æºæ¸…ç†
python test/test_resource_cleanup.py
```

## ç¤ºä¾‹ä»£ç 

### ç¨‹åºåŒ–ä½¿ç”¨æ¡†æ¶

```python
from framework.adapters import create_adapter
from framework.modules import create_module
from framework.tasks import create_task

# åˆ›å»ºé€‚é…å™¨
adapter = create_adapter("ch341", 0)
adapter.open()

try:
    # åˆ›å»ºæ¨¡ç»„
    module = create_module("ina3221", adapter, 0x40)
    module.initialize()
    
    # åˆ›å»ºä»»åŠ¡
    task = create_task("current_sampling", adapter, module)
    
    # æ‰§è¡Œä»»åŠ¡
    result = task.execute(
        duration_s=1.0,
        interval_ms=100.0,
        channels=None
    )
    
    # æ˜¾ç¤ºç»“æœ
    if hasattr(task, 'print_results'):
        task.print_results(result)
    
finally:
    # æ¸…ç†èµ„æº
    adapter.close()
```

### é…ç½®INA219æ¨¡ç»„

```python
# åˆ›å»ºINA219æ¨¡ç»„å¹¶é…ç½®å‚æ•°
module = create_module("ina219", adapter, 0x40)

# é…ç½®æ¨¡ç»„å‚æ•°
module.configure(
    shunt_resistor=0.1,        # 100mÎ©åˆ†æµç”µé˜»
    max_expected_current=2.0,  # æœ€å¤§æœŸæœ›ç”µæµ2A
    bus_voltage_range=16       # 16Væ€»çº¿ç”µå‹èŒƒå›´
)

module.initialize()
```

## å…¼å®¹æ€§è¯´æ˜

- âœ… ä¿æŒä¸ç°æœ‰äº¤äº’å¼æ¨¡å¼çš„å®Œå…¨å…¼å®¹
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½ç»§ç»­æ­£å¸¸å·¥ä½œ  
- âœ… æ–°å¢çš„å‘½ä»¤è¡Œå‚æ•°ä¸ºå¯é€‰åŠŸèƒ½
- âœ… æ”¯æŒWindows PowerShellå’Œå‘½ä»¤æç¤ºç¬¦
- âœ… æ”¯æŒPython 3.6+

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: 1.0.0
- **æ›´æ–°æ—¥æœŸ**: 2025å¹´7æœˆ2æ—¥
- **ä½œè€…**: Module Validation Framework Team
- **è®¸å¯è¯**: MIT License

## æ”¯æŒå’Œè´¡çŒ®

### è·å–å¸®åŠ©
- æŸ¥çœ‹ `test/examples.py` äº†è§£è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹
- è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ç¯å¢ƒé…ç½®
- ä½¿ç”¨ `--help` å‚æ•°æŸ¥çœ‹å‘½ä»¤è¡Œå¸®åŠ©

### è´¡çŒ®ä»£ç 
- Forké¡¹ç›®å¹¶åˆ›å»ºfeatureåˆ†æ”¯
- éµå¾ªç°æœ‰ä»£ç é£æ ¼å’Œæ¶æ„è®¾è®¡
- æ·»åŠ é€‚å½“çš„æµ‹è¯•å’Œæ–‡æ¡£
- æäº¤Pull Request

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–æƒ³è¦è´¡çŒ®ä»£ç ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
